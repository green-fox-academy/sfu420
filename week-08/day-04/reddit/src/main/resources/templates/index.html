<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reddit</title>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>tinymce.init({selector:'textarea'});</script>
</head>
<body>

    <header>
        <img src="./img/reddit_long.png" alt="A reddit logo with background picturing the universe">
        <div th:if="${successMessage} != null" th:text="${successMessage}"></div>
        <form th:action="@{/r/greenfox}" method="get">
            <input type="hidden" name="newThread" value="true"/>
            <input type="submit" value="New Thread"/>
        </form>
        <form th:action="@{/logout}" method="post">
            <input type="submit" value="Logout"/>
        </form>
    </header>

    <main>
        <table>
            <tr th:each="thread : ${threads}">
                <td th:text="${thread.getVote()}"></td>
                <td>
                    <span><a th:href="@{/r/greenfox/{threadId}/upvote(threadId=${thread.getId()})}">+</a></span>
                    <span><a th:href="@{/r/greenfox/{threadId}/downvote(threadId=${thread.getId()})}">-</a></span>
                </td>
                <td>
                    <div th:text="${thread.getTitle()}"></div>
                    <div th:utext="${thread.getContent()}"></div>
                    <div>
                        <span th:text="${thread.getUser().getUsername()}"></span>
                        <span th:text="${thread.getCreationDate()}"></span>
                        <button type="button"><a th:href="@{/r/greenfox/{threadId}/reply(threadId=${thread.getId()})}">Replay</a></button>
                        <th:block th:if="${thread.getUser() == currentUser}">
                            <form th:action="@{/r/greenfox}" method="get">
                                <input type="hidden" name="edit" value="true"/>
                                <input type="hidden" name="id" th:value="${thread.getId()}">
                                <input type="submit" value="Edit"/>
                            </form>
                            <form th:action="@{/r/greenfox/{id}/delete(id=${thread.getId()})}" method="get">
                                <input type="submit" value="Delete"/>
                            </form>
                        </th:block>
                    </div>
                </td>
            </tr>
        </table>
    </main>

    <th:block th:if="${newThread} == true">
        <form action="/r/greenfox/newThread" method="post" th:object="${newPost}">
            <label for="title">Title: </label>
            <input type="text" th:field="*{title}" required placeholder="Put the title of your post here">
            <textarea th:field="*{content}"></textarea>
            <input type="submit" value="Post">
        </form>
    </th:block>

    <th:block th:if="${editPost} == true">
        <form action="/r/greenfox/update" method="post" th:object="${currentPost}">
            <input type="hidden" name="id" id="id" th:value="*{id}">
            <label for="title">Title: </label>
            <input type="text" name="title" id="title" th:value="*{title}" required placeholder="Put the title of your post here">
            <textarea name="content" id="content" th:text="*{content}"></textarea>
            <input type="submit" value="Update">
        </form>
    </th:block>

    <aside>

    </aside>

</body>
</html>